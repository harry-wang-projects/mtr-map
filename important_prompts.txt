I want to make an moving map tracking the trains on Hong Kong's MTR system. To start, plot out the stations of the MTR's island line using dots and connect them with lines.

Plot it on a real map with correct coordinates. No need to label the station names. For now, don't make a difference between the interchange statinos and regular stations.

Next, I'm gonna add a moving train system. To do this, I'm gonna use "ticks" to simulate time, with each "tick" representing one second in real life. Every fixed amount of time, a train should spawn from one end of the line and travel across to the other side. The amount of time spent at each point (time between stations and time stopping at a station)should be editable by me. Once the train at the front goes to the other end and comes back, the trains should stop spawning and should keep moving around the line.

Due to performance issues, I need a major overhaul. From now, the generation and playing of the animation will be seperate steps. In the generation stage, the code will generate an array storing the positions of each train every second for a fixed period of time. During the playing stage, the code will play the moving positions. 
Also, since the amount of time needed to move/dwell at each stop is fixed, make it so that the trains spawn all in the beginning, spaced apart by x seconds where x is the train frequency. Make a function to calculate a train's position based on the time and offset and spawn the trains into their positions in the beginning. 

Make it so that lines are composed of one or more branches. Each branch keeps the same color as the line. However, it can take a different route and a different frequency. It also spawns it's own trains. Finally, make it so that an "offset time" can be added to branches, so that they begin spawning trains earlier or later than other branches. For existing lines, make the current line the only branch.

(failed) Add "checkpoints", stations that the trains go past but don't stop at. "Checkpoints" will also have "run" times. These times are proportional to the amount of time needed to travel from a station to the checkpoint. However, trains shouldn't decelerate. They should go at normal speed past the checkpoints. The progress vs time function should be run between station and station, not between checkpoint and checkpoint. Estimate the position based on the "run" values in the checkpoints.

Add a "checkpoints" array to each station, representing points that the train must past. Each point contains coordinates and a "progress" value representing how far the train has progressed (e.g. 0.3 means the train is 30% there.). When going in the direction of increasing station numbers, the "checkpoints" array of a station stores the checkpoints between that station and the station next to it with the larger station number. When going in the direction of decreasing station numbers, the "checkpoints" array of a station stores the checkpoints between the station with the larger station number and the station itself.
when drawing the map, make the lines go past the checkpoints (don't just draw the checkpoints as dots). Also, make the trains actually pass through the checkpoints. Right now, they are just going their original routes.
when returning, look at the checkpoints of the station with a lower station id, not the current station. Also, remember that the progress will be in reverse as the train is coming back.

The following code is javascript code for a video generator that generates videos of moving trains of the Hong Kong MTR. The positions of the trains get shown real time, where one tick represents one second. Each line is composed of one or more branches, which have their own routes and spawns trains until the first train makes a complete journey. The program generates data storing the location of each train every second, and then plays it afterwards. Do not edit the code yet.

Make it so that when generating a video, the animation duration only begins when all lines have stopped spawning trains (i.e. the actual amount of time generated is equal to the time taken for all trains to spawn plus the time requested). Display when the lines are still spawning during the video generation phase. When playing the video, start at the point when all trains spawned.

Right now, all lines are the same in that trains go along the stations and come back. Make it possible to specify a type for line branches. Current branches are of the "normal" type. Add "loop" branches where trains go to each station, and at the end of the last station, go back to the first station. The time taken to go from the last station to the first station is marked by the "run" parameter of the last station. Note that these loops should be single-directional, and trains should only move along the path (i.e. starting from the first station, going down the station numbers, and then going back to the first station) and not in the other direction.

Make an html textbox and button. When I click the button, I set a javascript variable to a json file given inside the textbox. Make sure that I can put the textbox and button anywhere in an existing project easily. Use textarea instead of input.



Editor:
I have a subway map that simulates moving subway trains. It takes in json files. The files store lines. Each line has a specific color and one or more branches. Each branch has train frequency parameter and a list of stations. Each station includes a latitutde and longtitude, dwell, and travel time, and possibly checkpoints between that station and the next station. Create an editor for such json files. On the left, the editor should have a place where I can edit all of the properties on individual lines and branchse, such as the coordinates of stations. On the top right, the editor should have a map displaying the lines (just the stations, no need for trains). On the botton right, there should be a preview of the json file that synchronizes with the editor on the left. Use vue.js to make this, but don't use node.js, just add it to an html file. Below is a sample of what one such json file looks like:

Currently, the left side of the editor is too narrow. Make it wider. 
To further reduce the space usage, implement the tab system on the branches of each line as well. In addition, make the parameters (e.g. name, latitude, longtitude, run time, dwell time) take up half a row instead of a full row. 
Put the "add station" button on the bottom of the list of stations. In addition, make a feature where one can set the coordinates of a station by clicking on a map.
When adding a station, make it use the set from map option by default. In addition, when a station is being set, don't zoom out of the map. Just keep the position and zoom as it is.